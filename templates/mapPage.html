<!DOCTYPE html>
<html lang="kor">

<head>
    <meta charset="UTP-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=4a81af8fef0943a32040477087ec034a"></script>
    <!-- <script type=" text/javascript" src="../static/js/kakaoMap.js"></script> -->
    <script type=" text/javascript" src="../static/js/mouseEvent.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="../static/css/kakaoMap.css"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/kakaoMap.css') }}">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <title>맵 Test</title>

</head>

<body>

    <!-- testData.txt 파일읽고 출력하기 -->
    <!-- {%for i in n%}
    <p>{{i}}</p>
    {% endfor%} -->
    <!-- testData.txt 파일읽고 출력하기 -->

    <!-- db데이터 쓰기 -->
    <!-- {%for i in data%}
    <p>{{i}}</p>
    {% endfor%} -->
    <!-- db데이터 쓰기-->

    <div class="container">
        <h1 style="text-align:center; font-size: 50px;">Map test</h1>

        <div id="left">
            <!-- onsubmit="return false;" -->
            <div class="searchBar">
                <!-- action="/searchCar" -->
                <!-- method="GET" -->
                <!-- onkeypress="JavaScript:press(this.form)" -->
                <form id="carnumForm" onsubmit="return false">
                    <input id="input" type="text" class="searchBar__input" name="search"
                        placeholder="Enter Plate Number" onkeyup="enterkey()">
                    <button type="button" class="searchBar__button" id="ajax">
                        <i class="material-icons">search</i>
                    </button>
                </form>
            </div>
            <p id="requirement">ex) 12마3456</p>
            <div id="searchDisplay">
                <!-- 버튼컴포넌트 삽입예정 -->
                <!-- {{carnum}}
                {{askInsert}} -->
            </div>
        </div>

        <div id="map"></div>
        <div id="right">
            <div id="excelAdd">Button of Adding File
                <form action="http://localhost:5000/xlupload" method="post" enctype="multipart/form-data">
                    <div id="button1" style="cursor: pointer;"><label for="add">Click and Upload</label>
                        <input type="file" name="file" id="add">
                    </div>

                    <div class="icon" style="cursor: pointer;">
                        <label for="sub">
                            <i class="material-icons md-48">
                                file_upload
                            </i>
                        </label><input type=submit value=Upload id="sub">
                    </div>
                </form>
            </div>
            <div id="markerVisible">Button of Marker On/Off
                <div id="button2" style="cursor: pointer;" onclick="showMarkers()">
                    <!-- Marker On -->
                    <i class="material-icons md-48">
                        push_pin
                    </i>
                    On
                </div>
                <div class="icon" style="cursor: pointer;" onclick="hideMarkers()">
                    <i class="material-icons md-48">
                        push_pin
                    </i>
                    off
                </div>
            </div>
            <hr />
            <div id="instanceBox">
                Waiting for making...
                <!-- 인스턴스조회 박스 -->
            </div>
        </div>
        <!-- <script type=" text/javascript" src="../static/js/kakaoMap.js"></script> -->
    </div>
    <!-- <script type="text/javascript" src="{{ url_for('static', filename = 'js/mouseEvent.js') }}"></script>
    <script type="text/javascript" src="{{ url_for('static', filename = 'js/instanceButton.js') }}"></script> -->




    <script>
        // window.onload = function () {
        // alert('카카오맵 호출');
        var msg = '{{ msg }}';
        if (msg == '[제출실패]') {
            alert('Excel파일을 제출해주세요..');
        }

        function markerOn() {
            alert('marker On');
        }

        function markerOff() {
            alert('marker Off');
        }

        var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
            mapOption = {
                center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                level: 3 // 지도의 확대 레벨
            };

        var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다
        // 마커에 커서가 오버됐을 때 마커 위에 표시할 인포윈도우를 생성합니다
        var iwContent = '<div style="text-align:left;disply:flex;width:200px;padding:5px;">Marker Number : ??? <br/> Plate Num : ??? <br/>Location of It : ???</div>'; // 인포윈도우에 표출될 내용으로 HTML 문자열이나 document element가 가능합니다
        // 인포윈도우를 생성합니다
        var infowindow = new kakao.maps.InfoWindow({
            content: iwContent
        });

        // 지도를 클릭했을때 클릭한 위치에 마커를 추가하도록 지도에 클릭이벤트를 등록합니다
        kakao.maps.event.addListener(map, 'click', function (mouseEvent) {
            // 클릭한 위치에 마커를 표시합니다 
            addMarker(mouseEvent.latLng);
        });

        // 지도에 표시된 마커 객체를 가지고 있을 배열입니다
        var markers = [];

        // 마커 하나를 지도위에 표시합니다 
        // addMarker(new kakao.maps.LatLng(33.450701, 126.570667));

        // 마커를 생성하고 지도위에 표시하는 함수입니다
        function addMarker(position) {

            // 마커를 생성합니다
            var marker = new kakao.maps.Marker({
                position: position
            });

            // 마커가 지도 위에 표시되도록 설정합니다
            marker.setMap(map);

            // 생성된 마커를 배열에 추가합니다
            markers.push(marker);

            // 마커에 마우스오버 이벤트를 등록합니다
            kakao.maps.event.addListener(marker, 'mouseover', function () {
                // 마커에 마우스오버 이벤트가 발생하면 인포윈도우를 마커위에 표시합니다
                infowindow.open(map, marker);
            });
            // 마커에 마우스아웃 이벤트를 등록합니다
            kakao.maps.event.addListener(marker, 'mouseout', function () {
                // 마커에 마우스아웃 이벤트가 발생하면 인포윈도우를 제거합니다
                infowindow.close();
            });
        }



        // 배열에 추가된 마커들을 지도에 표시하거나 삭제하는 함수입니다
        function setMarkers(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }

        // "마커 보이기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에 표시하는 함수입니다
        function showMarkers() {
            setMarkers(map)
        }

        // "마커 감추기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에서 삭제하는 함수입니다
        function hideMarkers() {
            setMarkers(null);
        }

        function randomColor() {
            // var colorCode = "#" + Math.round(Math.random() * 0xffffff).toString(16);
            var r = Math.round((Math.random() * (240 - 20 + 1)) + 20);
            var g = Math.round((Math.random() * (240 - 20 + 1)) + 20);
            var b = Math.round((Math.random() * (240 - 20 + 1)) + 20);
            alert("rgb(" + r + "," + g + "," + b + ")");
            // rgb(r,g,b) to String
            var colorCode = "rgb(" + r + "," + g + "," + b + ")";
            return colorCode;
        }

        function paintToDo(result) {
            toggle = result['toggle'];
            carnum = result['carnum'];
            if (toggle == 1) {
                // alert('버튼그리기');
                color = randomColor();
                var p = document.getElementById("searchDisplay");
                var newDIV = document.createElement("div");
                newDIV.innerHTML = carnum;
                newDIV.style.backgroundColor = color;
                newDIV.style.margin = "3px 3px 3px 3px";
                newDIV.style.height = "60px";
                newDIV.style.borderRadius = "10px 10px 10px 10px";
                newDIV.style.lineHeight = "60px";
                newDIV.style.fontWeight = "bold";
                newDIV.style.cursor = "pointer";
                newDIV.setAttribute("class", "instance");
                newDIV.onclick = function () {
                    alert('클릭');
                }
                newDIV.onmouseover = function () {
                    event.target.style.transform = "scale(0.9)";
                    event.target.style.transition = "all 0.3s";
                }
                newDIV.onmouseout = function () {
                    event.target.style.transform = "scale(1)";
                    event.target.style.transition = "all 0.3s";
                }
                p.appendChild(newDIV);
                $('#input').val('');
                // alert('버튼추가완료!' + '   {{askInsert}}');
            } else {
                $('#input').val('');
                alert('버튼추가실패!' + '   {{askInsert}}');
            }
        }



        $(function () {
            $('#ajax').click(function () {
                // alert('아작스 버튼이벤트 발생!');
                var formEdit = $("#input").val();
                // alert(formEdit + "를 전송합니다.")
                $.ajax({
                    type: 'GET',
                    url: '/searchCar',
                    data: { id: formEdit },
                    dataType: 'JSON',
                    success: function (result) {
                        // alert("결과 : " + result['carnum'] + "," + result['toggle']);
                        // alert('아작스 제출성공!');
                        paintToDo(result);
                    },
                    error: function (request, status, error) {
                        alert(request + ";" + status + ";" + eror);
                        alert('ajax error!');
                    }
                });
                // alert('form 전송성공!');
            });
        });
        $('#input').keypress(function (keyNum) {
            if (keyNum.which == 13) {
                $('#ajax').click();
                return false;
            }
        })
    </script>
</body>

</html>